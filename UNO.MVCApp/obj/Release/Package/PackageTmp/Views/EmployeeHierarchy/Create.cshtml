@model UNO.AppModel.EmployeeHierarchyCreateModel

@{
    ViewBag.Title = "Create";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<script src="~/Scripts/JS/multi.min.js"></script>
<link href="~/Content/css/multi.min.css" rel="stylesheet" />
<link href="~/Content/select2/css/select2.min.css" rel="stylesheet" />
<script src="~/Content/select2/js/select2.min.js"></script>
@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(true)
    <div class="main-container" style="clear:both;">
        <!-- Container fluid Starts -->
        <div class="container-fluid">
            <!-- Spacer Starts -->
            <div class="spacer clearfix">
                <div class="row">
                    <div class="col-md-12">
                        <div class="blog blog-default ">
                            <div class="blog-header ">
                                <h4 class="blog-title pull-left mt5">Add New </h4>
                                <span class="pull-right"><a class="btn btn-default" href="@Url.Action("Index")" data-original-title="" title=""><i class="fa fa-arrow-left"></i> Back </a> </span> <span class="clearfix"></span>
                            </div>
                            <div class="blog-body">
                                <div class="row mt5">
                                    <div class="col-sm-5">
                                        <div class="form-group row">
                                            @Html.LabelFor(model => model.Hier_Mgr_ID, new { @class = "col-md-4 pr0 form-control-label" })

                                            <div class="col-sm-7">
                                                @Html.DropDownListFor(model => model.Hier_Mgr_ID, (IEnumerable<SelectListItem>)ViewBag.Employees, "Select", new { @class = "form-control select2" })
                                                @Html.ValidationMessageFor(model => model.Hier_Mgr_ID, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <hr />
                                <div class="row mt5">
                                    <div class="col-sm-2 ">
                                        <div class="form-group">
                                            <strong>Employee</strong> <br />
                                            <label class="radio-inline mt5">
                                                <input type="radio" name="rdbEmployee" value="All" id="rdbEmployee">
                                                All
                                            </label>
                                            <label class="radio-inline">
                                                <input type="radio" name="rdbEmployee" value="Select" id="rdbEmployee">
                                                Select
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-sm-2 brl">
                                        <div class="form-group">
                                            <strong>Company</strong> <br />
                                            <label class="radio-inline mt5">
                                                <input type="radio" name="rdbCompany" value="All" id="rdbCompany">
                                                All
                                            </label>
                                            <label class="radio-inline">
                                                <input type="radio" name="rdbCompany" value="Select" id="rdbCompany">
                                                Select
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-sm-2 brl">
                                        <div class="form-group">
                                            <strong>Location</strong> <br />
                                            <label class="radio-inline mt5">
                                                <input type="radio" name="rdbLocation" value="All" id="rdbLocation">
                                                All
                                            </label>
                                            <label class="radio-inline">
                                                <input type="radio" name="rdbLocation" value="Select" id="rdbLocation">
                                                Select
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-sm-2 brl">
                                        <div class="form-group">
                                            <strong>Division</strong> <br />
                                            <label class="radio-inline mt5">
                                                <input type="radio" name="rdbDivision" value="All" id="rdbDivision">
                                                All
                                            </label>
                                            <label class="radio-inline mt5">
                                                <input type="radio" name="rdbDivision" value="Select" id="rdbDivision">
                                                Select
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-sm-2 brl">
                                        <div class="form-group">
                                            <strong>Department</strong> <br />
                                            <label class="radio-inline mt5">
                                                <input type="radio" name="rdbDepartment" value="All" id="rdbDepartment">
                                                All
                                            </label>
                                            <label class="radio-inline">
                                                <input type="radio" name="rdbDepartment" value="Select" id="rdbDepartment">
                                                Select
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <hr />
                                <div class="clearfix"></div>
                                <div class="col-md-6 col-centered hide" id="EntitySelection">
                                    <div id="divemployees" class="hide">
                                        @Html.DropDownList("ddlEmployees", (IEnumerable<SelectListItem>)ViewBag.Employees, null, new { @class = "form-control", multiple = "multiple", required = true, title = "Please Provide Employees" })
                                    </div>
                                    <div id="divcompanies" class="hide">
                                        @Html.DropDownList("ddlCompanies", (IEnumerable<SelectListItem>)ViewBag.Companies, null, new { @class = "form-control", multiple = "multiple", required = true, title = "Please Provide Companies" })
                                    </div><div id="divlocations" class="hide">
                                        @Html.DropDownList("ddlLocations", (IEnumerable<SelectListItem>)ViewBag.Locations, null, new { @class = "form-control", multiple = "multiple", required = true, title = "Please Provide Locations" })
                                    </div><div id="divdivisions" class="hide">
                                        @Html.DropDownList("ddlDivisions", (IEnumerable<SelectListItem>)ViewBag.Divisions, null, new { @class = "form-control", multiple = "multiple", required = true, title = "Please Provide Divisions" })
                                    </div><div id="divdepartments" class="hide">
                                        @Html.DropDownList("ddlDepartments", (IEnumerable<SelectListItem>)ViewBag.Departments, null, new { @class = "form-control", multiple = "multiple", required = true, title = "Please Provide Departments" })
                                    </div>
                                    <hr />
                                    <div class="clearfix text-center">
                                        <button type="button" class="btn btn-success okbtn"> <i class="fa fa-check"></i> OK </button>
                                        <button type="button" class="btn btn-danger btnclose"><i class="fa fa-times"></i> Close</button>
                                    </div>
                                </div>
                                <div class="col-md-12 table-responsive hide" id="EntitySelected">
                                    <div id="dt_example" class="table-responsive example_alt_pagination clearfix  p15 bg-info panel-info">
                                        <table class="table table-condensed table-striped table-hover table-bordered pull-left bg-white" id="lsttable">
                                            <thead>
                                                <tr>
                                                    <th style="width:35%">Employee ID</th>
                                                    <th style="width:65%">Employee Name	</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                        <table id="tableOne" class="collapse">
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>

                            </div>
                            <div class="form-actions">
                                <div class="row">
                                    <div class="col-md-12 text-center">
                                        <button type="submit" class="btn btn-info"> <i class="fa fa-save"></i> Save</button>
                                        <button id="btnReset" type="reset" class="btn default"><i class="fa fa-refresh"></i> Reset</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
}
<script type="text/javascript">

    var myTable;

    $(document).ready(function () {
        $("#btnReset").click(function () {
            location.reload();
        });
        $('.select2').select2({ closeOnSelect: true });

        var selectEmployees = document.getElementById('ddlEmployees');
        multi(selectEmployees, {
            non_selected_header: 'Parameters',
            selected_header: 'Selection'
        });

        var selectCompanies = document.getElementById('ddlCompanies');
        multi(selectCompanies, {
            non_selected_header: 'Parameters',
            selected_header: 'Selection'
        });

        var selectLocations = document.getElementById('ddlLocations');
        multi(selectLocations, {
            non_selected_header: 'Parameters',
            selected_header: 'Selection'
        });

        var selectDivisions = document.getElementById('ddlDivisions');
        multi(selectDivisions, {
            non_selected_header: 'Parameters',
            selected_header: 'Selection'
        });

        var selectDepartments = document.getElementById('ddlDepartments');
        multi(selectDepartments, {
            non_selected_header: 'Parameters',
            selected_header: 'Selection'
        });

        var grpEmployee = $("input[name=rdbEmployee]");
        var grpCompany = $("input[name=rdbCompany]");
        var grpLocation = $("input[name=rdbLocation]");
        var grpDivision = $("input[name=rdbDivision]");
        var grpDepartment = $("input[name=rdbDepartment]");

        grpEmployee.click(function () {
            myTable.clear();
            myTable.draw();
            $("#tableOne tbody").empty();

            grpCompany.prop("disabled", true);
            grpLocation.prop("disabled", true);
            grpDivision.prop("disabled", true);
            grpDepartment.prop("disabled", true);

            var checkedradio = grpEmployee.filter(":checked");
            if (checkedradio.val() == "All") {
                $("#EntitySelection").addClass("hide");
                $("#EntitySelected").addClass("hide");
                var items = $("#ddlEmployees option");
                bindTable(items);
            }
            else {
                var items = $("#ddlEmployees option:selected");
                bindTable(items);
                $("#EntitySelection").removeClass("hide");
                $("#divemployees").removeClass("hide");
            }
        });

        var companyurl = "employeeDtoByCompanyId";
        var locationurl = "employeeDtoByLocationId";
        var divisionurl = "employeeDtoByDivisionId";
        var departmenturl = "employeeDtoByDepartmentId";
        grpCompany.click(function () {
            myTable.clear();
            myTable.draw();
            $("#tableOne tbody").empty();
            grpEmployee.prop("disabled", true);
            var checkedradio = grpCompany.filter(":checked");
            if (checkedradio.val() == "All") {
                $("#EntitySelection").addClass("hide");
                $("#EntitySelected").addClass("hide");
                var items = $("#ddlCompanies option");
                bindEmployeesByEntities(items, companyurl);
            }
            else {
                var items = $("#ddlCompanies option:selected");
                bindEmployeesByEntities(items, companyurl);
                $("#EntitySelection").removeClass("hide");
                $("#divcompanies").removeClass("hide");
            }
        });

        grpLocation.click(function () {
            myTable.clear();
            myTable.draw();
            $("#tableOne tbody").empty();
            $("#divcompanies").addClass("hide");
            grpEmployee.prop("disabled", true);
            grpCompany.prop("disabled", true);
            grpDivision.prop("disabled", true);
            grpDepartment.prop("disabled", true);
            var checkedradio = grpLocation.filter(":checked");
            if (checkedradio.val() == "All") {
                $("#EntitySelection").addClass("hide");
                $("#EntitySelected").addClass("hide");
                var items = $("#ddlLocations option");
                bindEmployeesByEntities(items, locationurl);
            }
            else {
                var items = $("#ddlLocations option:selected");
                bindEmployeesByEntities(items, locationurl);
                $("#EntitySelection").removeClass("hide");
                $("#divlocations").removeClass("hide");
            }
        });


        grpDivision.click(function () {
            myTable.clear();
            myTable.draw();
            $("#tableOne tbody").empty();
            $("#divcompanies").addClass("hide");
            grpEmployee.prop("disabled", true);
            grpCompany.prop("disabled", true);
            grpLocation.prop("disabled", true);
            grpDepartment.prop("disabled", true);
            var checkedradio = grpDivision.filter(":checked");
            if (checkedradio.val() == "All") {
                $("#EntitySelection").addClass("hide");
                $("#EntitySelected").addClass("hide");
                var items = $("#ddlDivisions option");
                bindEmployeesByEntities(items, locationurl);
            }
            else {
                var items = $("#ddlDivisions option:selected");
                bindEmployeesByEntities(items, divisionurl);
                $("#EntitySelection").removeClass("hide");
                $("#divdivisions").removeClass("hide");
            }
        });

        grpDepartment.click(function () {
            myTable.clear();
            myTable.draw();
            $("#tableOne tbody").empty();
            $("#divcompanies").addClass("hide");
            grpEmployee.prop("disabled", true);
            grpCompany.prop("disabled", true);
            grpLocation.prop("disabled", true);
            grpDivision.prop("disabled", true);
            var checkedradio = grpDepartment.filter(":checked");
            if (checkedradio.val() == "All") {
                $("#EntitySelection").addClass("hide");
                $("#EntitySelected").addClass("hide");
                var items = $("#ddlDepartments option");
                bindEmployeesByEntities(items, locationurl);
            }
            else {
                var items = $("#ddlDepartments option:selected");
                bindEmployeesByEntities(items, departmenturl);
                $("#EntitySelection").removeClass("hide");
                $("#divdepartments").removeClass("hide");
            }
        });

        myTable = $("#lsttable").DataTable();

        $(".okbtn").click(function () {
            $("#EntitySelected").removeClass("hide");
            $("#EntitySelection").addClass("hide");

        });
        $(".btnclose").click(function () {
            $("#EntitySelection").addClass("hide");
        });

        $("#ddlCompanies").change(function () {
            if ($("#ddlCompanies option:selected").length > 0) {
                var items = $("#ddlCompanies option:selected");
                bindEmployeesByEntities(items, companyurl);
            }
            else {
                myTable.clear();
                myTable.draw();
                $("#tableOne tbody").empty();
            }
        });

        $("#ddlLocations").change(function () {
            if ($("#ddlLocations option:selected").length > 0) {
                var items = $("#ddlLocations option:selected");
                bindEmployeesByEntities(items, locationurl);
            }
            else {
                myTable.clear();
                myTable.draw();
                $("#tableOne tbody").empty();
            }
        });

        $("#ddlDivisions").change(function () {
            if ($("#ddlDivisions option:selected").length > 0) {
                var items = $("#ddlDivisions option:selected");
                bindEmployeesByEntities(items, divisionurl);
            }
            else {
                myTable.clear();
                myTable.draw();
                $("#tableOne tbody").empty();
            }
        });

        $("#ddlDepartments").change(function () {
            if ($("#ddlDepartments option:selected").length > 0) {
                var items = $("#ddlDepartments option:selected");
                bindEmployeesByEntities(items, departmenturl);
            }
            else {
                myTable.clear();
                myTable.draw();
                $("#tableOne tbody").empty();
            }
        });

        $('#ddlEmployees').change(function () {
            if ($("#ddlEmployees option:selected").length > 0) {
                var items = $("#ddlEmployees option:selected");
                bindTable(items);
            }
            else {
                myTable.clear();
                myTable.draw();
                $("#tableOne tbody").empty();
            }

        });
    });

    //function BindItemTable() {
    //    myTable = $("#lsttable").DataTable({
    //        "deferRender": true,
    //        "paging": true,
    //        "lengthChange": false,
    //        "searching": true,
    //        "ordering": true,
    //        "info": true,
    //        "autoWidth": false,
    //        "sDom": 'lfrtip'
    //    });
    //}

    function bindEmployeesByEntities(items, url) {
        var uri = '@System.Configuration.ConfigurationManager.AppSettings["APIUrl"].ToString()';
        var userid = '@Session["ACTIVE_USER"].ToString()';
        var headers = {};
        if (userid) {
            headers.activeuser = userid;
        }
        $("#tableOne tbody").empty();
        myTable.clear();
        $.each(items, function (key, value) {
            console.log(key);
            console.log(value.value);
            var i = 0;
            $.ajax({
                type: 'GET',
                headers: headers,
                url: uri + url + "/" + value.value,

                success: function (data) {

                    if (data) {
                        bindTableByEntities(data)
                    }
                    else {

                    }
                },
                error: function (jqXHR) {
                    debugger;
                }
            });
        });
    }

    function bindTableByEntities(items) {
        $.each(items, function (key, value) {
            var row = ''
            row += '<tr>';
            row += '<td>';
            var empId = '@Html.TextBoxFor(model => Model.Employees[-1].EMPLOYEE_ID, new { Value = "$empid" })';
            empId = empId.replace("[-1]", "[" + key + "]");
            empId = empId.replace("-1", key);
            empId = empId.replace("$empid", value.EMPLOYEE_ID);
            row += empId;
            row += '</td>';
            row += '<td>';


            row += '</tr>';
            var result = [];
            result.push(value.EOD_EMPID);
            result.push(value.FULL_NAME);

            var Result = result;


            myTable.row.add(Result);
            myTable.draw();
            $("#tableOne tbody").append(row);
        });
    }

    function bindTable(items) {
        var uri = '@System.Configuration.ConfigurationManager.AppSettings["APIUrl"].ToString()';
        $("#tableOne tbody").empty();
        myTable.clear();
        $.each(items, function (key, value) {
            console.log(key);
            console.log(value.value);
            var str = value.text;
            var res = str.split(" - ");

            var row = ''
            row += '<tr>';
            row += '<td>';
            var empId = '@Html.TextBoxFor(model => Model.Employees[-1].EMPLOYEE_ID, new { Value = "$empid" })';
            empId = empId.replace("[-1]", "[" + key + "]");
            empId = empId.replace("-1", key);
            empId = empId.replace("$empid", value.value);
            row += empId;
            row += '</td>';
           


            row += '</tr>';
            var result = [];
            result.push(res[1]);
            result.push(res[0]);

            var Result = result;


            myTable.row.add(Result);
            myTable.draw();
            $("#tableOne tbody").append(row);




            //$.ajax({
            //    type: 'GET',
            //    url: uri + "employeeDto/" + value.value,

            //    success: function (data) {

            //        if (data) {

            //        }
            //        else {

            //        }
            //    },
            //    error: function (jqXHR) {
            //        debugger;
            //    }
            //});


        });

        var form = $("form");
        form.data('validator', null);
        $.validator.unobtrusive.parse(form);
    }





</script>