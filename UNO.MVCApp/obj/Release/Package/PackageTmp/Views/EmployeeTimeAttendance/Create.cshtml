@model  UNO.AppModel.EmployeeTimeAttendanceCreateModel

@{
    ViewBag.Title = "Create";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<script src="~/Scripts/JS/multi.min.js"></script>
<link href="~/Content/css/multi.min.css" rel="stylesheet" />
<link href="~/Content/select2/css/select2.min.css" rel="stylesheet" />
<script src="~/Content/select2/js/select2.min.js"></script>
<script src="~/Scripts/JS/jquery.datetimepicker.full.js"></script>


@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(true)

    <div class="main-container" style="clear:both;">
        <!-- Container fluid Starts -->
        <div class="container-fluid">
            <!-- Spacer Starts -->
            <div class="spacer clearfix">
                <div class="row">
                    <div class="col-md-12">
                        <div class="blog blog-default ">
                            <div class="blog-header ">
                                <h4 class="blog-title pull-left mt5">Add New </h4>
                                <span class="pull-right"><a class="btn btn-default" href="@Url.Action("Index")" data-original-title="" title=""><i class="fa fa-arrow-left"></i> Back </a> </span> <span class="clearfix"></span>
                            </div>
                            <div class="blog-body">
                                <div class="row mt5">
                                    <div class="col-sm-2 ">
                                        <div class="form-group" id="radioBtnDiv1">
                                            <strong>Employee</strong> <br />
                                            <label class="radio-inline mt5">
                                                <input type="radio" name="Employee" value="selectallemployee" id="allemployee">
                                                All
                                            </label>
                                            <label class="radio-inline">
                                                <input type="radio" name="Employee" value="selectemployee" id="selectedemployee">
                                                Select
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-sm-2 brl">
                                        <div class="form-group" id="radioBtnDiv2">
                                            <strong>Company</strong> <br />
                                            <label class="radio-inline mt5">
                                                <input type="radio" name="Company" value="selectallCompany">
                                                All
                                            </label>
                                            <label class="radio-inline">
                                                <input type="radio" name="Company" value="Company">
                                                Select
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-sm-2 brl">
                                        <div class="form-group" id="radioBtnDiv3">
                                            <strong>Location</strong> <br />
                                            <label class="radio-inline mt5">
                                                <input type="radio" name="Location" value="selectallLocation">
                                                All
                                            </label>
                                            <label class="radio-inline">
                                                <input type="radio" name="Location" value="Location">
                                                Select
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-sm-2 brl">
                                        <div class="form-group" id="radioBtnDiv4">
                                            <strong>Division</strong> <br />
                                            <label class="radio-inline mt5">
                                                <input type="radio" name="Division" value="selectallDivision">
                                                All
                                            </label>
                                            <label class="radio-inline mt5">
                                                <input type="radio" name="Division" value="Division">
                                                Select
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-sm-2 brl">
                                        <div class="form-group" id="radioBtnDiv5">
                                            <strong>Department</strong> <br />
                                            <label class="radio-inline mt5">
                                                <input type="radio" name="Department" value="selectallDepartment">
                                                All
                                            </label>
                                            <label class="radio-inline">
                                                <input type="radio" name="Department" value="Department">
                                                Select
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-sm-2 brl">
                                        <div class="form-group" id="radioBtnDiv6">
                                            <strong> Category</strong> <br />
                                            <label class="radio-inline mt5">
                                                <input type="radio" name="Category" value="selectallCategory">
                                                All
                                            </label>
                                            <label class="radio-inline">
                                                <input type="radio" name="Category" value="Category">
                                                Select
                                            </label>
                                        </div>
                                    </div>

                                </div>


                                <hr />
                                <div class="clearfix"></div>
                                @*<div class="col-md-6 col-centered" id="EmployeeSelection">
                                    <select multiple="multiple" name="parameter_select" id="parameter_select">
                                        <option>Emplyoyee 001</option>
                                        <option>Emplyoyee 002</option>
                                        <option>Emplyoyee 003</option>
                                        <option>Emplyoyee 004</option>
                                        <option>Emplyoyee 005</option>
                                        <option>Emplyoyee 006</option>
                                        <option>Emplyoyee 007</option>
                                        <option>Emplyoyee 008</option>
                                        <option>Emplyoyee 009</option>
                                        <option>Emplyoyee 0010</option>
                                        <option>Emplyoyee 0011</option>
                                        <option>Emplyoyee 0012 </option>
                                    </select>
                                    <hr />*@
                                <div class="col-md-6 col-centered hide" id="EntitySelection">
                                    <div id="divemployees" class="hide">
                                        @Html.DropDownList("ddlEmployees", (IEnumerable<SelectListItem>)ViewBag.Employees, null, new { @class = "form-control", multiple = "multiple", required = true, title = "Please Provide Employees" })
                                    </div>
                                    <div id="divcompanies" class="hide">
                                        @Html.DropDownList("ddlCompanies", (IEnumerable<SelectListItem>)ViewBag.Companies, null, new { @class = "form-control", multiple = "multiple", required = true, title = "Please Provide Companies" })
                                    </div><div id="divlocations" class="hide">
                                        @Html.DropDownList("ddlLocations", (IEnumerable<SelectListItem>)ViewBag.Locations, null, new { @class = "form-control", multiple = "multiple", required = true, title = "Please Provide Locations" })
                                    </div><div id="divdivisions" class="hide">
                                        @Html.DropDownList("ddlDivisions", (IEnumerable<SelectListItem>)ViewBag.Divisions, null, new { @class = "form-control", multiple = "multiple", required = true, title = "Please Provide Divisions" })
                                    </div><div id="divdepartments" class="hide">
                                        @Html.DropDownList("ddlDepartments", (IEnumerable<SelectListItem>)ViewBag.Departments, null, new { @class = "form-control", multiple = "multiple", required = true, title = "Please Provide Departments" })
                                    </div><div id="divcategorys" class="hide">
                                        @Html.DropDownList("ddlCategorys", (IEnumerable<SelectListItem>)ViewBag.Categories, null, new { @class = "form-control", multiple = "multiple", required = true, title = "Please Provide Category" })
                                    </div>

                                    <hr />
                                    <div class="clearfix text-center">
                                        <button type="button" class="btn btn-success okbtn"> <i class="fa fa-check"></i> OK </button>
                                        <button type="button" class="btn btn-danger btnclose"><i class="fa fa-times"></i> Close</button>
                                    </div>
                                </div>
                                <div class="col-md-12 table-responsive hide" id="EntitySelected">
                                    <div id="dt_example" class="table-responsive example_alt_pagination clearfix  p15 bg-info panel-info">
                                        <table class="table table-condensed table-striped table-hover table-bordered pull-left bg-white" id="lsttable">
                                            <thead>
                                                <tr>
                                                    <th style="width:35%">Employee ID</th>
                                                    <th style="width:65%">Employee Name	</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                        <table id="tableOne" class="collapse">
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>

                                <hr />
                                <div class="clearfix"></div>





                                <div class="row mt5">

                                    <div class="col-sm-5">

                                        <div class="form-group row">
                                            <label class="col-md-4 form-control-label text-right"> Minimum swipe </label>
                                            <div class="col-sm-7"> @Html.TextBoxFor(m => m.ETC_MINIMUM_SWIPE, new { @class = "form-control" })</div>
                                            @Html.ValidationMessageFor(model => model.ETC_MINIMUM_SWIPE, "", new { @class = "text-danger" })
                                        </div>
                                    </div>


                                    <div class="clearfix"></div>
                                    <div class="col-sm-5">

                                        <div class="form-group row">
                                            <label class="col-md-4 form-control-label text-right">Week Off </label>
                                            <div class="col-sm-7"> @Html.DropDownListFor(model => model.ETC_WEEKOFF, (IEnumerable<SelectListItem>)ViewBag.weekoffattandance2, "Select Week OFF", new { @class = "form-control"})</div>
                                            @Html.ValidationMessageFor(model => model.ETC_WEEKOFF, "", new { @class = "text-danger" })                                       
                                        </div>

                                    </div>
                                    <div class="col-sm-5">

                                        <div class="form-group row">
                                            <label class="col-md-4 form-control-label text-right">Week End</label>
                                            <div class="col-sm-7"> @Html.DropDownListFor(model => model.ETC_WEEKEND, (IEnumerable<SelectListItem>)ViewBag.weekendattandance2, "Select Week End", new { @class = "form-control"}) </div>
                                            @Html.ValidationMessageFor(model => model.ETC_WEEKEND, "", new { @class = "text-danger" }) 
                                        </div>

                                    </div>
                                    <div class="col-sm-5">

                                        <div class="form-group row">
                                            <label class="col-md-4 form-control-label text-right">Shift Start Date</label>
                                            <div class="col-sm-7"> @Html.TextBoxFor(m => m.ETC_SHIFT_START_DATE, new { @class = "form-control" })</div>
                                            @Html.ValidationMessageFor(model => model.ETC_SHIFT_START_DATE, "", new { @class = "text-danger" }) 
                                        </div>

                                    </div>


                                    



                                    <div class="col-sm-5">

                                        <div class="form-group row">
                                            <label class="col-md-4 form-control-label text-right">Select Shift</label>
                                            
                                            <div class="col-sm-7" id="divfixed">@Html.DropDownListFor(model => model.ETC_SHIFTCODE, (IEnumerable<SelectListItem>)ViewBag.shiftpattern2, "Select Shift Pattern", new { @class = "form-control" })</div>
                                            @Html.ValidationMessageFor(model => model.ETC_SHIFTCODE, "", new { @class = "text-danger" })
                                            
                                            </div>

                                    </div>




                                </div>
                            </div>
                            <div class="form-actions">
                                <div class="row  mt5">
                                    <div class="col-md-12 text-center">
                                        <button type="submit" class="btn btn-info"> <i class="fa fa-save"></i> Save</button>
                                        <button type="button" id="btnreset" class="btn default"><i class="fa fa-refresh"></i> Reset</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
}
<script type="text/javascript">

    var myTable;



    $(document).ready(function () {


       

        $("#ETC_SHIFT_START_DATE").datepicker({});


        var selectEmployees = document.getElementById('ddlEmployees');
        multi(selectEmployees, {
            non_selected_header: 'Parameters',
            selected_header: 'Selection'
        });

        var selectCompanies = document.getElementById('ddlCompanies');
        multi(selectCompanies, {
            non_selected_header: 'Parameters',
            selected_header: 'Selection'
        });

        var selectLocations = document.getElementById('ddlLocations');
        multi(selectLocations, {
            non_selected_header: 'Parameters',
            selected_header: 'Selection'
        });

        var selectDivisions = document.getElementById('ddlDivisions');
        multi(selectDivisions, {
            non_selected_header: 'Parameters',
            selected_header: 'Selection'
        });

        var selectDepartments = document.getElementById('ddlDepartments');
        multi(selectDepartments, {
            non_selected_header: 'Parameters',
            selected_header: 'Selection'
        });

        var selectCategorys = document.getElementById('ddlCategorys');
        multi(selectCategorys, {
            non_selected_header: 'Parameters',
            selected_header: 'Selection'
        });

        var companyurl = "employeeDtoByCompanyIdattandance";
        var locationurl = "employeeDtoByLocationIdattandance";
        var divisionurl = "employeeDtoByDivisionIdattandance";
        var departmenturl = "employeeDtoByDepartmentIdattandance";
        var categoryurl = "employeeDtoByCategoryIdattandance";




        var grpEmployee = $("input[name=Employee]");
        var grpCompany = $("input[name=Company]");
        var grpLocation = $("input[name=Location]");
        var grpDivision = $("input[name=Division]");
        var grpDepartment = $("input[name=Department]");
        var grpCategory = $("input[name=Category]");
        var resetbtn = $("#btnreset");

        resetbtn.click(function () {
            location.reload()
        });


        grpEmployee.click(function () {
            grpLocation.attr('disabled', true);
            grpDivision.attr('disabled', true);
            grpDepartment.attr('disabled', true);
            grpCategory.attr('disabled', true);
            grpCompany.attr('disabled', true);
            if ($(this).val() === 'selectallemployee') {
                $("#EntitySelection").addClass("hide");
                $("#EntitySelected").addClass("hide");
                var items = $("#ddlEmployees option");
                bindTable(items);
                console.log('selectallemployee');

            }
            else {

                $("#EntitySelection").removeClass("hide");
                $("#divemployees").removeClass("hide");
                var items = $("#ddlEmployees option:selected");
                bindTable(items);
                console.log('Selected');

            }
        });



        grpCompany.click(function () {
            grpLocation.attr('disabled', true);
            grpDivision.attr('disabled', true);
            grpDepartment.attr('disabled', true);
            grpCategory.attr('disabled', true);
            grpEmployee.attr('disabled', true);
            if ($(this).val() === 'selectallCompany') {
                $("#EntitySelection").addClass("hide");
                $("#EntitySelected").addClass("hide");
                var items = $("#ddlCompanies option");
                bindEmployeesByEntities(items, companyurl);
                console.log('selectallCompany');

            }
            else {
                var items = $("#ddlCompanies option:selected");
                bindEmployeesByEntities(items, companyurl);
                $("#EntitySelection").removeClass("hide");
                $("#divcompanies").removeClass("hide");
                console.log('Selected');

            }
        });



        grpLocation.click(function () {
            grpCompany.attr('disabled', true);
            grpDivision.attr('disabled', true);
            grpDepartment.attr('disabled', true);
            grpCategory.attr('disabled', true);
            grpEmployee.attr('disabled', true);
            if ($(this).val() === 'selectallLocation') {
                $("#EntitySelection").addClass("hide");
                $("#EntitySelected").addClass("hide");
                var items = $("#ddlLocations option");
                bindEmployeesByEntities(items, locationurl);
                console.log('selectallCompany');

            }
            else {
                var items = $("#ddlLocations option:selected");
                bindEmployeesByEntities(items, locationurl);
                $("#EntitySelection").removeClass("hide");
                $("#divlocations").removeClass("hide");
                console.log('Selected');

            }
        });


        grpDivision.click(function () {
            grpCompany.attr('disabled', true);
            grpLocation.attr('disabled', true);
            grpDepartment.attr('disabled', true);
            grpCategory.attr('disabled', true);
            grpEmployee.attr('disabled', true);
            if ($(this).val() === 'selectallDivision') {
                $("#EntitySelection").addClass("hide");
                $("#EntitySelected").addClass("hide");
                var items = $("#ddlDivisions option");
                bindEmployeesByEntities(items, locationurl);
                console.log('selectallCompany');

            }
            else {
                var items = $("#ddlDivisions option:selected");
                bindEmployeesByEntities(items, divisionurl);
                $("#EntitySelection").removeClass("hide");
                $("#divdivisions").removeClass("hide");
                console.log('Selected');

            }
        });



        grpDepartment.click(function () {
            grpCompany.attr('disabled', true);
            grpLocation.attr('disabled', true);
            grpDivision.attr('disabled', true);
            grpCategory.attr('disabled', true);
            grpEmployee.attr('disabled', true);
            if ($(this).val() === 'selectallDepartment') {
                $("#EntitySelection").addClass("hide");
                $("#EntitySelected").addClass("hide");
                var items = $("#ddlDepartments option");
                bindEmployeesByEntities(items, locationurl);
                console.log('selectallCompany');

            }
            else {
                var items = $("#ddlDepartments option:selected");
                bindEmployeesByEntities(items, departmenturl);
                $("#EntitySelection").removeClass("hide");
                $("#divdepartments").removeClass("hide");
                console.log('Selected');

            }
        });



        grpCategory.click(function () {
            grpCompany.attr('disabled', true);
            grpLocation.attr('disabled', true);
            grpDivision.attr('disabled', true);
            grpDepartment.attr('disabled', true);
            grpEmployee.attr('disabled', true);
            if ($(this).val() === 'selectallCategory') {
                $("#EntitySelection").addClass("hide");
                $("#EntitySelected").addClass("hide");
                var items = $("#ddlCategorys option");
                bindEmployeesByEntities(items, categoryurl);
                console.log('selectallCompany');

            }
            else {
                var items = $("#ddlCategorys option:selected");
                bindEmployeesByEntities(items, categoryurl);
                $("#EntitySelection").removeClass("hide");
                $("#divcategorys").removeClass("hide");
                console.log('Selected');

            }
        });














        //$('.multiselect').multiselect();
        $("#EmployeeSelection").hide();

        myTable = $("#lsttable").DataTable();

        $(".okbtn").click(function () {
            $("#EntitySelected").removeClass("hide");
            $("#EntitySelection").addClass("hide");

        });
        $(".btnclose").click(function () {
            $("#EntitySelection").addClass("hide");
        });

        $("#ddlCompanies").change(function () {
            if ($("#ddlCompanies option:selected").length > 0) {
                var items = $("#ddlCompanies option:selected");
                bindEmployeesByEntities(items, companyurl);
            }
            else {
                myTable.clear();
                myTable.draw();
                $("#tableOne tbody").empty();
            }
        });



        $("#ddlCategorys").change(function () {
            if ($("#ddlCategorys option:selected").length > 0) {
                var items = $("#ddlCategorys option:selected");
                bindEmployeesByEntities(items, categoryurl);
            }
            else {
                myTable.clear();
                myTable.draw();
                $("#tableOne tbody").empty();
            }
        });



        $("#ddlLocations").change(function () {
            if ($("#ddlLocations option:selected").length > 0) {
                var items = $("#ddlLocations option:selected");
                bindEmployeesByEntities(items, locationurl);
            }
            else {
                myTable.clear();
                myTable.draw();
                $("#tableOne tbody").empty();
            }
        });

        $("#ddlDivisions").change(function () {
            if ($("#ddlDivisions option:selected").length > 0) {
                var items = $("#ddlDivisions option:selected");
                bindEmployeesByEntities(items, divisionurl);
            }
            else {
                myTable.clear();
                myTable.draw();
                $("#tableOne tbody").empty();
            }
        });

        $("#ddlDepartments").change(function () {
            if ($("#ddlDepartments option:selected").length > 0) {
                var items = $("#ddlDepartments option:selected");
                bindEmployeesByEntities(items, departmenturl);
            }
            else {
                myTable.clear();
                myTable.draw();
                $("#tableOne tbody").empty();
            }
        });

        $('#ddlEmployees').change(function () {
            if ($("#ddlEmployees option:selected").length > 0) {
                var items = $("#ddlEmployees option:selected");
                bindTable(items);
            }
            else {
                myTable.clear();
                myTable.draw();
                $("#tableOne tbody").empty();
            }

        });

    });








    function bindEmployeesByEntities(items, url) {
        var uri = '@System.Configuration.ConfigurationManager.AppSettings["APIUrl"].ToString()';
        var userid = '@Session["ACTIVE_USER"].ToString()';
        var headers = {};
        if (userid) {
            headers.activeuser = userid;
        }
        $("#tableOne tbody").empty();
        //myTable.clear();
        $.each(items, function (key, value) {
            console.log(key);
            console.log(value.value);
            var i = 0;
            $.ajax({
                type: 'GET',
                headers: headers,
                url: uri + url + "/" + value.value,

                success: function (data) {

                    if (data) {
                        bindTableByEntities(data)
                    }
                    else {

                    }
                },
                error: function (jqXHR) {
                    debugger;
                }
            });
        });
    }





    function bindTableByEntities(items) {
        $.each(items, function (key, value) {
            var row = ''
            row += '<tr>';
            row += '<td>';
            var empId = '@Html.TextBoxFor(model => Model.Employees[-1].EMPLOYEE_ID, new { Value = "$empid" })';
            empId = empId.replace("[-1]", "[" + key + "]");
            empId = empId.replace("-1", key);
            empId = empId.replace("$empid", value.EMPLOYEE_ID);
            row += empId;
            row += '</td>';
            row += '<td>';


            row += '</tr>';
            var result = [];
            result.push(value.EOD_EMPID);
            result.push(value.FULL_NAME);

            var Result = result;


            myTable.row.add(Result);
            myTable.draw();
            $("#tableOne tbody").append(row);
        });
    }













    function bindTable(items) {
        debugger
        var uri = '@System.Configuration.ConfigurationManager.AppSettings["APIUrl"].ToString()';
        $("#tableOne tbody").empty();
        myTable.clear();
        $.each(items, function (key, value) {
            console.log(key);
            console.log(value.value);
            var str = value.text;
            var res = str.split(" - ");

            var row = ''
            row += '<tr>';
            row += '<td>';
            var empId = '@Html.TextBoxFor(model => Model.Employees[-1].EMPLOYEE_ID, new { Value = "$empid" })';
            empId = empId.replace("[-1]", "[" + key + "]");
            empId = empId.replace("-1", key);
            empId = empId.replace("$empid", value.value);
            row += empId;
            row += '</td>';



            row += '</tr>';
            var result = [];
            result.push(res[1]);
            result.push(res[0]);

            var Result = result;
            debugger

            myTable.row.add(Result);
            myTable.draw();
            $("#tableOne tbody").append(row);







        });

        var form = $("form");
        form.data('validator', null);
        $.validator.unobtrusive.parse(form);
    }





</script>
