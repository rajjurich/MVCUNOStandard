@model UNO.AppModel.EventBrowser

@{
    ViewBag.Title = "Events";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>
    .switch {
        position: relative;
        display: inline-block;
        width: 50px;
        height: 18px;
        float: left;
        margin-right: 5px;
    }

    input[type="radio"] {
        margin: 0px 2px 0;
        margin-top: 1px \9;
        line-height: normal;
        float: left;
    }

    .radio-inline, .checkbox-inline {
        position: relative;
        display: inline-block;
        padding-left: 10px;
        margin-bottom: 0;
        font-weight: normal;
        vertical-align: middle;
        cursor: pointer;
    }

    .switch input {
        display: none;
    }

    .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        -webkit-transition: .4s;
        transition: .4s;
    }

        .slider:before {
            position: absolute;
            content: "";
            height: 15px;
            width: 15px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
        }

    input:checked + .slider {
        background-color: #2196F3;
    }

    input:focus + .slider {
        box-shadow: 0 0 1px #2196F3;
    }

    input:checked + .slider:before {
        -webkit-transform: translateX(26px);
        -ms-transform: translateX(26px);
        transform: translateX(26px);
    }

    /* Rounded sliders */
    .slider.round {
        border-radius: 34px;
        height: 22px;
    }

        .slider.round:before {
            border-radius: 50%;
        }

    .table-responsive {
        min-height: .01%;
        overflow-x: visible;
        /* z-index: -1; */
        margin-top: -30PX;
    }
</style>
@section scripts
{
    <script>
        var createNewPage = '@Url.Action("Index", "EventBrowser")';
    
        $(document).ready(function () {
            
            if ('@ViewBag.CreateAccess' == "False") {
                $(".btnCreateNew").hide();
            }
            if ('@ViewBag.ViewAccess' == "False") {
                $(".btn-success").hide();
            }
            if ('@ViewBag.EditAccess' == "False") {
                $(".btn-info").hide();
            }
            if ('@ViewBag.DeleteAccess' == "False") {
                $(".btn-danger").hide();
            }
            $("[type=checkbox]").click(function () {
                

                if ($("#EnableSync").is(":checked") == true) {
                    var Timer = setInterval(SyncEnabled, 3000);
                    $("#isRefresh").val(true);
                    $("#hdnTimmer").val(Timer);
                }
                else {
                    clearInterval($("#hdnTimmer").val());
                    $("#isRefresh").val(false);
                }
            });
            $('input[type=radio][name=chkRadio]').change(function () {
                if (this.value == '1') {
                    $("#Event_Type").val(1);
                }
                if (this.value == '2') {
                    $("#Event_Type").val(2);
                }
                if (this.value == '3') {
                    $("#Event_Type").val(3);
                }
                SyncEnabled();
            });
            $("#Level_Id").change(function () {
                //if ($('#Level_Id').find(":selected").text() == "All") {
                //    $("#Level_Id").val(0);
                //}
                SyncEnabled();
            });
            if ($("#Event_Type").val() == '1') {
                $("input[name=chkRadio][value=" + '1' + "]").attr('checked', 'checked');
                //$("#Event_Type").val(1);
            }
            if ($("#Event_Type").val() == '2') {
                $("input[name=chkRadio][value=" + '2' + "]").attr('checked', 'checked');
            }
            if ($("#Event_Type").val() == '3') {
                $("input[name=chkRadio][value=" + '3' + "]").attr('checked', 'checked');
            }
            if ($("#isRefresh").val() == "true") {
                $("#EnableSync").prop("checked", true);
            } else {
                $("#EnableSync").prop("checked", false);
            }
            $('#lsttable').dataTable({
                "sPaginationType": "full_numbers",
                dom: 'lBfrtip',
                "bInfo": false,
                oLanguage: {
                    sLengthMenu: "Show: _MENU_",
                },
                "aoColumnDefs": [
              { "bSortable": false, "aTargets": [5] }
                ],
                /* fnInitComplete : function( oSettings, json ){
                     $('#dataTables_length').detach().prependTo("#new-location");
    
           },*/
                buttons: [
                    {
                        text: '<i class="fa fa-plus-circle"></i> Add New',
                        action: function myFunction() {
                            location.href = createNewPage;
                        },
                        attr: {
                            id: 'btnCreateNew'
                        }
                    }
                ]

            });
            $("#btnCreateNew").hide();
            SyncEnabled();
        });
        function SyncEnabled() {
            //$.ajax({
            //    url: UNOUrl + 'EventBrowser/Index',
            //    success: function (data) { alert(data); },
            //    statusCode: {
            //        404: function (content) { alert('cannot find resource'); },
            //        500: function (content) { alert('internal server error'); }
            //    },
            //    error: function (req, status, errorObj) {
            //        // handle status === "timeout"
            //        // handle other errors
            //    }
            //});
           
            $.ajax({
                url: BaseAddress + "EventBrowserAPI/get/" + $("#Event_Type").val() + "/" + $("#Level_Id").val(),
                cache: false,
                type: "GET",
                success: function (data) {
                    DataList = data;
                    var str = ""; 
                    for (var i = 0; i < DataList.length; i++) {
                        str += "<tr><td class='text-center'>" + DataList[i].Event_Type + "</td>";
                        str += "<td class='text-center'>" + DataList[i].Event_Datetime + "</td>";
                        str += "<td class='text-center'>" + DataList[i].Emp_Name + "</td>";
                        str += "<td class='text-center'>" + DataList[i].Event_Employee_Code + "</td>";
                        str += "<td class='text-center'>" + DataList[i].Event_Card_Code + "</td>";
                        str += "<td class='text-center'>" + DataList[i].ReaderD + "</td>";
                        str += "<td class='text-center'>" + DataList[i].CtrlD + "</td>";
                        str += "<td class='text-center'>" + DataList[i].Event_Status + "</td>";
                        str += "<td class='text-center'>" + DataList[i].Event_Alarm_Type + "</td>";
                        str += "<td class='text-center'>" + DataList[i].Event_Alarm_Action + "</td></tr>";
                    }
                    if ($.fn.dataTable.isDataTable('#lsttable')) {
                        var table = $('#lsttable').dataTable();

                        table.fnClearTable();
                        table.fnDestroy();
                        $("#data").html(str);

                        $("#lsttable").dataTable(
                            {
                                "sPaginationType": "full_numbers",
                                oLanguage: {
                                    sLengthMenu: "Show: _MENU_",
                                },
                                pageLength: 10,
                                "aoColumns": [
                                            null,
                                            null,
                                            null,
                                            null,
                                            null,
                                             null,
                                            null,
                                            null,
                                            null,
                                            null
                                ]
                            });
                    }
                    else {
                        var s = "";
                        $("#data").html(str);

                        $("#lsttable").dataTable(
                           {
                               "sPaginationType": "full_numbers",
                               oLanguage: {
                                   sLengthMenu: "Show: _MENU_",
                               },
                               pageLength: 10,
                               "aoColumns": [
                                            null,
                                            null,
                                            null,
                                            null,
                                            null,
                                             null,
                                            null,
                                            null,
                                            null,
                                            null
                               ]
                           });
                    }
                },
                error: function (reponse) {
                }
            });
        }
  
    </script>
}
@using (Html.BeginForm())
{
    @Html.HiddenFor(m => m.Event_Type)
    @Html.HiddenFor(m => m.isRefresh)
    @Html.HiddenFor(m=>m.hdnTimmer)
    <!-- Container fluid Starts -->
    <div class="container-fluid">
        <!-- Spacer Starts -->
        <div class="spacer clearfix">
            <div class="row">
                <div class="col-md-12">
                    <div class="blog blog-default ">
                        <div class="blog-header ">
                            <h4 class="blog-title pull-left mt5">Listing</h4>
                            <div class="dt-buttons pull-right">
                                <a class="btn btn-default" href="#"><span><i class="fa fa-print"></i> Print</span></a> <a class="btn btn-default" href="#"><span><i class="fa fa-file-excel-o"></i> Excel</span></a>
                            </div>
                            <span class="clearfix"></span>
                        </div>

                        <span class="clearfix"></span>
                        <div class="blog-body">
                            <div class="table-responsive">
                                <div style="float: left; position: relative; top: 29px;" class="col-md-7">
                                    <div class="row">
                                        <div class="col-md-7">
                                            <label class="switch">
                                                <input id="EnableSync" type="checkbox">
                                                <span class="slider round"></span>
                                            </label>
                                            <span style="text-decoration-color: blue; line-height: 25px;"> Refresh | </span>
                                            <span style="text-decoration-color: blue; line-height: 25px;">Select Event Type :</span>
                                            <div id="chkRadio" class="checkbox-inline ">
                                                <span> <label>All <input type="radio" value="1" name="chkRadio"></label></span>
                                                <span> <label>Card <input type="radio" value="2" name="chkRadio"></label></span>
                                                <span> <label>Alarm <input type="radio" value="3" name="chkRadio"></label></span>
                                            </div>
                                        </div><div class="col-md-2  text-right">
                                            <label style="margin-top: 6px;">Select Level:</label>
                                        </div> <div class="col-md-3">
                                            @Html.DropDownListFor(model => model.Level_Id, (IEnumerable<SelectListItem>)ViewBag.ListLevel, new { @class = "form-control" })
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div id="dt_example" class="table-responsive example_alt_pagination clearfix">
                                <table id="lsttable" class="table table-condensed table-striped table-hover table-bordered pull-left">
                                    <thead>
                                        <tr>
                                            <th class="text-center">Type</th>
                                            <th class="text-center">Datetime</th>
                                            <th class="text-center">Name</th>
                                            <th class="text-center">Emp Code</th>
                                            <th class="text-center">Card Code</th>
                                            <th class="text-center">Reader</th>
                                            <th class="text-center">Controller</th>
                                            <th class="text-center">Status</th>
                                            <th class="text-center">A Type</th>
                                            <th class="text-center">A Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="data">
                                    </tbody>

                                </table>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Spacer Ends -->
}
<!-- Container fluid ends -->
<script>
    $('#btnCreateNew').click(function () {
        document.location = '';
    });
    
</script>